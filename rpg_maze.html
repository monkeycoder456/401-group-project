<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Roguelike RPG Maze</title>
<style>
    body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
    }

    #stats {
        margin: 10px;
        font-size: 18px;
    }

    #maze {
        display: grid;
        gap: 2px;
        justify-content: center;
        margin: auto;
    }

    .cell {
        width: 30px;
        height: 30px;
    }

    .wall { background: #333; }
    .path { background: #bbb; }
    .player { background: dodgerblue; }
    .power { background: limegreen; }
    .boss { background: crimson; }
    .exit { background: gold; }
</style>
</head>
<body>

<h1>üó∫Ô∏è Roguelike Maze RPG</h1>

<div id="stats">
    üè∞ Floor: <span id="floor">1</span> |
    ‚ù§Ô∏è HP: <span id="hp">10</span> |
    ‚ö° Power: <span id="power">1</span>
</div>

<div id="maze"></div>
<p id="message"></p>

<script>
/* ===== GAME STATE ===== */
let floor, size, orbCount, powerNeeded;
let mazeData = [];
let bossAlive = true;

let player = { x: 1, y: 1, hp: 10, power: 1 };

const maze = document.getElementById("maze");
const message = document.getElementById("message");

/* ===== RESET / START ===== */
function resetGame() {
    floor = 1;
    size = 15;
    orbCount = 5;
    powerNeeded = 5;
    bossAlive = true;

    player.hp = 10;
    player.power = 1;
    player.x = 1;
    player.y = 1;

    message.textContent = "üíÄ You died. Back to Floor 1.";

    generateMaze();
    placeEntities();
    drawMaze();

    document.removeEventListener("keydown", controls);
    document.addEventListener("keydown", controls);
}

/* ===== MAZE GENERATION ===== */
function generateMaze() {
    mazeData = Array.from({ length: size }, () => Array(size).fill(1));

    function carve(x, y) {
        mazeData[y][x] = 0;
        const dirs = [[0,-2],[0,2],[-2,0],[2,0]].sort(() => Math.random() - 0.5);

        for (const [dx, dy] of dirs) {
            const nx = x + dx, ny = y + dy;
            if (nx > 0 && ny > 0 && nx < size-1 && ny < size-1 && mazeData[ny][nx] === 1) {
                mazeData[y + dy/2][x + dx/2] = 0;
                carve(nx, ny);
            }
        }
    }
    carve(1,1);
}

function randomEmptyCell() {
    let x, y;
    do {
        x = Math.floor(Math.random() * size);
        y = Math.floor(Math.random() * size);
    } while (mazeData[y][x] !== 0 || (x === 1 && y === 1));
    return {x,y};
}

function placeEntities() {
    for (let i = 0; i < orbCount; i++) {
        const p = randomEmptyCell();
        mazeData[p.y][p.x] = 3;
    }

    const boss = randomEmptyCell();
    mazeData[boss.y][boss.x] = 4;

    const exit = randomEmptyCell();
    mazeData[exit.y][exit.x] = 2;
}

/* ===== DRAW ===== */
function drawMaze() {
    maze.innerHTML = "";
    maze.style.gridTemplateColumns = `repeat(${size}, 30px)`;

    mazeData.forEach((row,y)=>{
        row.forEach((cell,x)=>{
            const div = document.createElement("div");
            div.className = "cell";

            if (cell === 1) div.classList.add("wall");
            else if (cell === 2 && !bossAlive) div.classList.add("exit");
            else if (cell === 3) div.classList.add("power");
            else if (cell === 4 && bossAlive) div.classList.add("boss");
            else div.classList.add("path");

            if (player.x === x && player.y === y)
                div.className = "cell player";

            maze.appendChild(div);
        });
    });

    document.getElementById("floor").textContent = floor;
    document.getElementById("hp").textContent = player.hp;
    document.getElementById("power").textContent = player.power;
}

/* ===== GAME LOGIC ===== */
function fightBoss() {
    if (player.power >= powerNeeded) {
        bossAlive = false;
        mazeData[player.y][player.x] = 0;
        message.textContent = "üëπ Boss defeated! Exit unlocked!";
    } else {
        player.hp -= 3;
        message.textContent = "üëπ The boss crushes you!";

        if (player.hp <= 0) {
            resetGame();
            return;
        }
    }
}

function move(dx, dy) {
    const nx = player.x + dx, ny = player.y + dy;
    if (nx<0 || ny<0 || nx>=size || ny>=size) return;

    const cell = mazeData[ny][nx];
    if (cell === 1) return;

    player.x = nx;
    player.y = ny;

    if (cell === 3) {
        player.power++;
        mazeData[ny][nx] = 0;
        message.textContent = "üíé Power increased!";
    }

    if (cell === 4 && bossAlive) fightBoss();

    if (cell === 2 && !bossAlive) {
        floor++;
        size += 2;
        orbCount += 2;
        powerNeeded += 2;
        bossAlive = true;

        player.x = 1;
        player.y = 1;

        message.textContent = "üèÜ Descending to the next floor...";
        generateMaze();
        placeEntities();
    }

    drawMaze();
}

function controls(e) {
    if (e.key==="ArrowUp") move(0,-1);
    if (e.key==="ArrowDown") move(0,1);
    if (e.key==="ArrowLeft") move(-1,0);
    if (e.key==="ArrowRight") move(1,0);
}

/* ===== START GAME ===== */
resetGame();
</script>

</body>
</html>
